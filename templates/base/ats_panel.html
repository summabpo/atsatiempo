{% load static %}

<div class="card shadow-sm">
    <div class="card-header">
        <h3 class="card-title">Entrevistas </h3>
        <div class="card-toolbar">
            <button type="button" class="btn btn-sm btn-light">
                Pendiente
            </button>
        </div>
    </div>
    <div class="card-body">
        <div id="calendar"></div>

        <!-- Modal de Información Calendario -->
        <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered mw-650px">
                <div class="modal-content">
                    <div class="modal-header border-0 justify-content-end" id="eventModalLabel">
                        {% comment %} <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-primary me-2" data-bs-toggle="tooltip" data-bs-dismiss="click" title="Edit Event" id="kt_modal_view_event_edit">
                            <i class="ki-duotone ki-pencil fs-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                        </div>
                        <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-danger me-2" data-bs-toggle="tooltip" data-bs-dismiss="click" title="Delete Event" id="kt_modal_view_event_delete">
                            <i class="ki-duotone ki-trash fs-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                                <span class="path4"></span>
                                <span class="path5"></span>
                            </i>
                        </div> {% endcomment %}
                        <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-primary" data-bs-toggle="tooltip" title="Hide Event" data-bs-dismiss="modal">
                            <i class="ki-duotone ki-cross fs-2x">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                        </div>
                    </div>
                    <div class="modal-body pt-0 pb-20 px-lg-17">
                        <div class="d-flex">
                            <i class="ki-duotone ki-calendar-8 fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                                <span class="path4"></span>
                                <span class="path5"></span>
                                <span class="path6"></span>
                            </i>
                            <div class="mb-9">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="fs-3 fw-bold me-3" id="eventTitle"></span>
                                </div>
                                
                                <div class="fs-6" id="eventDescription"></div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="ki-duotone ki-brifecase-tick fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-6">
                                <span class="fw-bold">Cliente:</span>
                                <span id="nombre_cliente"></span>

                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-9">
                            <i class="ki-duotone ki-award fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-6">
                                <span class="fw-bold">Vacante:</span>
                                <span id="nombre_vacante"></span>

                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <span class="bullet bullet-dot h-10px w-10px bg-success ms-2 me-7"></span>
                            <div class="fs-6">
                                <span class="fw-bold">Inicio:</span>
                                <span id="event_start_date"></span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-10">
                            <span class="bullet bullet-dot h-10px w-10px bg-danger ms-2 me-7"></span>
                            <div class="fs-6">
                                <span class="fw-bold">Fin:</span>
                                <span id="event_end_date"></span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-10">
                            <i class="ki-duotone ki-geolocation fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-6">
                                <span class="fw-bold">Lugar Enlace:</span>
                                <span id="eventPlaceLink"></span>

                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="ki-duotone ki-notification-status fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-6">
                                <span class="fw-bold">Estado:</span>
                                <span id="estado_asignacion"></span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="eventModal" tabindex="-1" data-bs-focus="false" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered mw-650px">
                <div class="modal-content">
                    <div class="modal-header border-0 justify-content-end">
                        <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-primary me-2" data-bs-toggle="tooltip" data-bs-dismiss="click" title="Edit Event" id="kt_modal_view_event_edit">
                            <i class="ki-duotone ki-pencil fs-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                        </div>
                        <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-danger me-2" data-bs-toggle="tooltip" data-bs-dismiss="click" title="Delete Event" id="kt_modal_view_event_delete">
                            <i class="ki-duotone ki-trash fs-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                                <span class="path4"></span>
                                <span class="path5"></span>
                            </i>
                        </div>
                        <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-primary" data-bs-toggle="tooltip" title="Hide Event" data-bs-dismiss="modal">
                            <i class="ki-duotone ki-cross fs-2x">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                        </div>
                    </div>
                    
                    <div class="modal-body pt-0 pb-20 px-lg-17">
                        <div class="d-flex">
                            <i class="ki-duotone ki-calendar-8 fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                                <span class="path4"></span>
                                <span class="path5"></span>
                                <span class="path6"></span>
                            </i>
                            <div class="mb-9">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="fs-3 fw-bold me-3" data-kt-calendar="event_name"></span>
                                    <span class="badge badge-light-success" data-kt-calendar="all_day"></span>
                                </div>
                                <div class="fs-6" data-kt-id="event_description"></div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <span class="bullet bullet-dot h-10px w-10px bg-success ms-2 me-7"></span>
                            <div class="fs-6">
                                <span class="fw-bold">Starts</span>
                                <span id="event_start_date"></span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-9">
                            <span class="bullet bullet-dot h-10px w-10px bg-danger ms-2 me-7"></span>
                            <div class="fs-6">
                                <span class="fw-bold">Ends</span>
                                <span id="event_end_date"></span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="ki-duotone ki-geolocation fs-1 text-muted me-5">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                            <div class="fs-6" id="lugar_enlace"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card-footer">
        Actualización a la Fecha
    </div>
</div>

<script src="{% static 'plugins/custom/fullcalendar/fullcalendar.bundle.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');

        var todayDate = moment().startOf('day');
        var YM = todayDate.format('YYYY-MM');
        var YESTERDAY = todayDate.clone().subtract(1, 'day').format('YYYY-MM-DD');
        var TODAY = todayDate.format('YYYY-MM-DD');
        var TOMORROW = todayDate.clone().add(1, 'day').format('YYYY-MM-DD');

        const calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
            },
            initialView: 'dayGridMonth',
            locale: 'es',
            events: 'vacante/api/mostrar_entrevistas_calendario/',
            
            // Al momento de hacer clic en el evento detro de Calendario
            eventClick: function(info) {
                // Evitar el comportamiento predeterminado
                info.jsEvent.preventDefault();
                
                // Mostrar los detalles en el modal
                document.getElementById('eventTitle').textContent = info.event.title;
                
                // Mostrar la fecha y hora de inicio
                const startDate = info.event.start;
                document.getElementById('event_start_date').textContent = startDate.toLocaleString('es-ES');

                // Calcular la hora de finalización (1 hora después de la hora de inicio)
                const endDate = new Date(startDate);
                endDate.setHours(startDate.getHours() + 1);

                // Mostrar la fecha y hora de fin
                document.getElementById('event_end_date').textContent = endDate.toLocaleString('es-ES');
                
                // Aquí accedes correctamente al campo `lugar_enlace`
                const lugarEnlace = info.event.extendedProps.lugar_enlace || 'No especificado';
                document.getElementById('eventPlaceLink').textContent = lugarEnlace;
                
                document.getElementById('eventDescription').textContent = info.event.extendedProps.description || 'Sin descripción';
                
                // Aquí accedes correctamente al campo `vacante`
                const nombre_vacante = info.event.extendedProps.nombre_vacante || 'No especificado';
                document.getElementById('nombre_vacante').textContent = nombre_vacante;
                
                // Aquí accedes correctamente al campo `cliente`
                const nombre_cliente = info.event.extendedProps.nombre_cliente || 'No especificado';
                document.getElementById('nombre_cliente').textContent = nombre_cliente;
                
                // Aquí accedes correctamente al campo `estado asignacion`
                //const estado_asignacion = info.event.extendedProps.estado_asignacion || 'No especificado';
                //document.getElementById('estado_asignacion').textContent = estado_asignacion;

                const estado_asignacion = document.getElementById('estado_asignacion');
                estado_asignacion.textContent = info.event.extendedProps.estado_asignacion || 'No especificado';
                

                // Mostrar el modal
                const eventModal = new bootstrap.Modal(document.getElementById('eventModal'));
                eventModal.show();

            },
        });
        calendar.render();
    });
    
</script>