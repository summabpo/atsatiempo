{% extends 'admin/layout/dashboard_base.html' %} 

{% load static %}
{% load crispy_forms_tags %}

{% block title %}
Información Básica | Talent Tray
{% endblock %}

{% block styles %}
<style>
    /* Estilos para campos con errores */
    .is-invalid {
        border-color: #dc3545 !important;
        background-color: #fff5f5 !important;
    }
    
    .is-invalid:focus {
        border-color: #dc3545 !important;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
    }
    
    .has-error label {
        color: #dc3545 !important;
        font-weight: 600;
    }
    
    .has-error .text-danger {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
    
    /* Ocultar input file nativo */
    .custom-file-input {
        position: absolute !important;
        opacity: 0 !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        pointer-events: none !important;
    }
    
    /* Ocultar el enlace "Actualmente:" que aparece arriba del campo file */
    #id_imagen_perfil + a,
    #id_hoja_de_vida + a,
    #id_video_perfil + a,
    #id_imagen_perfil ~ a,
    #id_hoja_de_vida ~ a,
    #id_video_perfil ~ a,
    .col-md-4:has(#id_imagen_perfil) a[href*="media_uploads"],
    .col-md-4:has(#id_hoja_de_vida) a[href*="media_uploads"],
    .col-md-4:has(#id_video_perfil) a[href*="media_uploads"] {
        display: none !important;
    }
    
    /* Ocultar cualquier texto que contenga "Actualmente" o rutas de archivos */
    .col-md-4:has(#id_imagen_perfil) small:contains("Actualmente"),
    .col-md-4:has(#id_hoja_de_vida) small:contains("Actualmente"),
    .col-md-4:has(#id_video_perfil) small:contains("Actualmente"),
    .col-md-4:has(#id_imagen_perfil) span:contains("Actualmente"),
    .col-md-4:has(#id_hoja_de_vida) span:contains("Actualmente"),
    .col-md-4:has(#id_video_perfil) span:contains("Actualmente") {
        display: none !important;
    }
    
    .custom-file-label {
        display: inline-block;
        padding: 0.5rem 1rem;
        background-color: #B10022;
        color: white;
        border: 1px solid #B10022;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: all 0.15s ease-in-out;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .custom-file-label:hover {
        background-color: #8b0019;
        border-color: #8b0019;
        color: white;
    }
    
    .file-info-display {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background-color: transparent;
        border: none;
    }
    
    /* Estilos para checkboxes en línea horizontal */
	.fit-cultural-checkboxes .form-check {
		display: inline-block !important;
		margin-right: 20px !important;
		margin-bottom: 10px !important;
		min-width: 180px !important;
	}

	.fit-cultural-checkboxes .form-check-input {
		margin-right: 8px !important;
	}

	.fit-cultural-checkboxes .form-check-label {
		display: inline !important;
		font-size: 14px !important;
		white-space: nowrap !important;
	}

	/* Responsive para pantallas pequeñas */
	@media (max-width: 768px) {
		.fit-cultural-checkboxes .form-check {
			min-width: 150px !important;
			margin-right: 15px !important;
		}
	}

	/* Estilos para motivadores también */
	.motivadores .form-check {
		display: inline-block !important;
		margin-right: 20px !important;
		margin-bottom: 10px !important;
		min-width: 180px !important;
	}
	
	/* Estilos para las descripciones dentro de los radio buttons de fit cultural */
	.form-check-label small.text-muted {
		display: block;
		font-size: 0.85rem;
		color: #6c757d !important;
		font-style: italic;
		line-height: 1.4;
		margin-top: 0.25rem;
		padding-left: 0;
		opacity: 0.85;
	}
	
	/* Mejorar el espaciado de los radio buttons con descripciones */
	.form-check {
		margin-bottom: 1rem;
		padding-left: 1.5rem;
	}
	
	.form-check-label {
		cursor: pointer;
		width: 100%;
	}
	
	/* Estilos para las explicaciones de fit cultural - solo grupo 1 (Estilo trabajo) */
	#id_grupo_fit_1 + .help-block,
	.form-group:has(#id_grupo_fit_1) .help-block {
		font-size: 0.875rem;
		color: #6c757d;
		font-style: italic;
		margin-top: 0.5rem;
		margin-bottom: 1rem;
		line-height: 1.5;
		padding: 0.5rem 0.75rem;
		background-color: rgba(177, 0, 34, 0.03);
		border-left: 3px solid rgba(177, 0, 34, 0.2);
		border-radius: 4px;
	}
	
	/* Estilos alternativos para help-text de crispy forms - solo grupo 1 */
	.form-group label[for="id_grupo_fit_1"] ~ small,
	.form-group #id_grupo_fit_1 ~ small {
		display: block;
		font-size: 0.875rem;
		color: #6c757d;
		font-style: italic;
		margin-top: 0.5rem;
		margin-bottom: 1rem;
		line-height: 1.5;
		padding: 0.5rem 0.75rem;
		background-color: rgba(177, 0, 34, 0.03);
		border-left: 3px solid rgba(177, 0, 34, 0.2);
		border-radius: 4px;
		font-weight: 400;
	}
	
	/* Asegurar que el texto de ayuda del grupo 1 sea visible pero discreto */
	.form-group:has(#id_grupo_fit_1) .form-text.text-muted {
		font-size: 0.875rem !important;
		color: #6c757d !important;
		font-style: italic;
		margin-top: 0.5rem;
		margin-bottom: 1rem;
		line-height: 1.5;
		padding: 0.5rem 0.75rem;
		background-color: rgba(177, 0, 34, 0.03);
		border-left: 3px solid rgba(177, 0, 34, 0.2);
		border-radius: 4px;
	}
</style>
{% endblock %}

{% block content %}
<div class="main-content-container overflow-hidden">
	<div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
		<h3 class="mb-0" style="color: #B10022;">INFORMACIÓN BÁSICA</h3>
		<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
			<ol class="breadcrumb align-items-center mb-0 lh-1">
				<li class="breadcrumb-item">
					<a href="{% url 'accesses:inicio' %}" class="d-flex align-items-center text-decoration-none">
						<i class="ri-home-4-line fs-18 text-primary me-1"></i>
						<span class="text-secondary fw-medium hover" >Inicio</span>
					</a>
				</li>
				<li class="breadcrumb-item active" aria-current="page">
					<span class="fw-medium">Información Básica</span>
				</li>
			</ol>
		</nav>
	</div>

	<!-- Panel de información -->
	{% include 'admin/candidate/candidate_user/layout/base_candidate_info_records.html' %}

	<!-- Start Your Code -->
    

    <div class="row">
		<div class="col-12">
            <div class="card bg-white border-0 rounded-3 mb-4">
				<div class="card-body p-4">
                    <form method="post" id="form_info_personal" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}
                        {% comment %} {% crispy form %} {% endcomment %}
                        <!-- INSERT_YOUR_CODE -->
                        <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                            <div class="row">
                                <div class="d-flex align-items-center my-4">
									<h6 class="mb-0 pe-3 text-primary fw-bold">DATOS PERSONALES</h6>
									<hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
								</div>
                                <div class="col-md-3 mb-3">
                                    {{ form.primer_nombre.label_tag }} {{ form.primer_nombre }}
                                    {% if form.primer_nombre.errors %}
                                        <div class="text-danger small">{{ form.primer_nombre.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.segundo_nombre.label_tag }} {{ form.segundo_nombre }}
                                    {% if form.segundo_nombre.errors %}
                                        <div class="text-danger small">{{ form.segundo_nombre.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.primer_apellido.label_tag }} {{ form.primer_apellido }}
                                    {% if form.primer_apellido.errors %}
                                        <div class="text-danger small">{{ form.primer_apellido.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.segundo_apellido.label_tag }} {{ form.segundo_apellido }}
                                    {% if form.segundo_apellido.errors %}
                                        <div class="text-danger small">{{ form.segundo_apellido.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.numero_documento.label_tag }} {{ form.numero_documento }}
                                    {% if form.numero_documento.errors %}
                                        <div class="text-danger small">{{ form.numero_documento.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.fecha_nacimiento.label_tag }} {{ form.fecha_nacimiento }}
                                    {% if form.fecha_nacimiento.errors %}
                                        <div class="text-danger small">{{ form.fecha_nacimiento.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.sexo.label_tag }} {{ form.sexo }}
                                    {% if form.sexo.errors %}
                                        <div class="text-danger small">{{ form.sexo.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3 mb-3">
                                    {{ form.aspiracion_salarial.label_tag }} {{ form.aspiracion_salarial }}
                                    {% if form.aspiracion_salarial.errors %}
                                        <div class="text-danger small">{{ form.aspiracion_salarial.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                            <div class="row">
                                <div class="d-flex align-items-center my-4">
									<h6 class="mb-0 pe-3 text-primary fw-bold">CONTACTO</h6>
									<hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
								</div>
                                <div class="col-md-6 mb-3">
                                    {{ form.email.label_tag }} {{ form.email }}
                                    {% if form.email.errors %}
                                        <div class="text-danger small">{{ form.email.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form.telefono.label_tag }} {{ form.telefono }}
                                    {% if form.telefono.errors %}
                                        <div class="text-danger small">{{ form.telefono.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form.ciudad_id_004.label_tag }} {{ form.ciudad_id_004 }}
                                    {% if form.ciudad_id_004.errors %}
                                        <div class="text-danger small">{{ form.ciudad_id_004.errors }}</div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form.direccion.label_tag }} {{ form.direccion }}
                                    {% if form.direccion.errors %}
                                        <div class="text-danger small">{{ form.direccion.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                            <div class="row">
                                <div class="d-flex align-items-center my-4">
									<h6 class="mb-0 pe-3 text-primary fw-bold">PERFIL</h6>
									<hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
								</div>
                                <div class="col-md-12 mb-3">
                                    {{ form.perfil.label_tag }} {{ form.perfil }}
                                    {% if form.perfil.errors %}
                                        <div class="text-danger small">{{ form.perfil.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                            <div class="row">
                                <div class="d-flex align-items-center my-4">
									<h6 class="mb-0 pe-3 text-primary fw-bold">DOCUMENTOS</h6>
									<hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
								</div>
                                <div class="col-md-4 mb-3">
                                    {{ form.imagen_perfil.label_tag }}
                                    <div class="position-relative d-inline-block w-100">
                                        {{ form.imagen_perfil }}
                                        <label for="id_imagen_perfil" class="custom-file-label w-100 text-center">
                                            <i class="ri-upload-cloud-line me-1"></i> Seleccionar imagen
                                        </label>
                                    </div>
                                    {% if form.imagen_perfil.errors %}
                                        <div class="text-danger small">{{ form.imagen_perfil.errors }}</div>
                                    {% endif %}
                                    <!-- Botón único para ver archivo (nuevo o existente) -->
                                    <div id="file_info_imagen_perfil" class="file-info-display mt-2" style="display: none;">
                                        <div class="d-flex justify-content-end align-items-center">
                                            <button type="button" class="btn btn-sm bg-primary bg-opacity-10 fw-medium text-primary" data-bs-toggle="modal" data-bs-target="#modal_imagen_perfil" id="btn_ver_imagen_perfil">
                                                <i class="ri-eye-line me-1"></i> Ver
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.hoja_de_vida.label_tag }}
                                    <div class="position-relative d-inline-block w-100">
                                        {{ form.hoja_de_vida }}
                                        <label for="id_hoja_de_vida" class="custom-file-label w-100 text-center">
                                            <i class="ri-upload-cloud-line me-1"></i> Seleccionar archivo
                                        </label>
                                    </div>
                                    {% if form.hoja_de_vida.errors %}
                                        <div class="text-danger small">{{ form.hoja_de_vida.errors }}</div>
                                    {% endif %}
                                    <!-- Botón único para ver archivo (nuevo o existente) -->
                                    <div id="file_info_hoja_de_vida" class="file-info-display mt-2" style="display: none;">
                                        <div class="d-flex justify-content-end align-items-center">
                                            <button type="button" class="btn btn-sm bg-primary bg-opacity-10 fw-medium text-primary" data-bs-toggle="modal" data-bs-target="#modal_hoja_de_vida" id="btn_ver_hoja_de_vida">
                                                <i class="ri-eye-line me-1"></i> Ver
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.video_perfil.label_tag }}
                                    <div class="position-relative d-inline-block w-100">
                                        {{ form.video_perfil }}
                                        <label for="id_video_perfil" class="custom-file-label w-100 text-center">
                                            <i class="ri-upload-cloud-line me-1"></i> Seleccionar video
                                        </label>
                                    </div>
                                    {% if form.video_perfil.help_text %}
                                        <small class="form-text text-muted">{{ form.video_perfil.help_text }}</small>
                                    {% endif %}
                                    {% if form.video_perfil.errors %}
                                        <div class="text-danger small">{{ form.video_perfil.errors }}</div>
                                    {% endif %}
                                    <!-- Botón único para ver archivo (nuevo o existente) -->
                                    <div id="file_info_video_perfil" class="file-info-display mt-2" style="display: none;">
                                        <div class="d-flex justify-content-end align-items-center">
                                            <button type="button" class="btn btn-sm bg-primary bg-opacity-10 fw-medium text-primary" data-bs-toggle="modal" data-bs-target="#modal_video_perfil" id="btn_ver_video_perfil">
                                                <i class="ri-eye-line me-1"></i> Ver
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
						<div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
							<div class="d-flex align-items-center my-4">
								<h6 class="mb-0 pe-3 text-primary fw-bold">FIT CULTURAL</h6>
								<hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
							</div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="alert alert-info" role="alert">
                                        <h4 class="alert-heading">
                                            <span class="material-symbols-outlined text-info me-2">psychology</span>
                                            Selecciona tus habilidades blandas
                                        </h4>
                                        <p>
                                            En esta sección podrás elegir el entorno y estilo de cultura donde te sientes más cómodo y das lo mejor de ti: cómo prefieres trabajar, el liderazgo que más te impulsa, tu ritmo ideal, la forma en que te comunicas y cómo tomas decisiones.
Lo que selecciones nos permitirá ubicarte en una empresa donde no solo encajes por tu experiencia técnica, sino donde realmente puedas fluir, aportar valor y crecer.
.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="col-md-12">
                                    <p>Selecciona una opción por cada categoría (Estilo de trabajo, Liderazgo, Ritmo, Comunicación y Decisiones). Marca lo que más se ajusta a tu realidad: así lograremos un match auténtico entre tu estilo y la cultura de la empresa.</p>
                                </div>
                                <hr class="my-4">
                                <div class="col-md-4">
                                    {{ form.grupo_fit_1|as_crispy_field }}
                                </div> 
                                <div class="col-md-4">
                                    {{ form.grupo_fit_2|as_crispy_field }}
                                </div> 
                                <div class="col-md-4">
                                    {{ form.grupo_fit_3|as_crispy_field }}
                                </div> 
                                <div class="col-md-4">
                                    {{ form.grupo_fit_4|as_crispy_field }}
                                </div> 
                                <div class="col-md-4">
                                    {{ form.grupo_fit_5|as_crispy_field }}
                                </div> 
                            </div>
						</div>

                        
                        <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                            <div class="d-flex align-items-center my-4">
                                <h6 class="mb-0 pe-3 text-primary fw-bold">MOTIVADORES</h6>
                                <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="alert alert-info" role="alert">
                                        <h4 class="alert-heading">
                                            <span class="material-symbols-outlined text-info me-2">emoji_objects</span>
                                            Selecciona tus motivadores
                                        </h4>
                                        <p>
                                            En esta sección podrás seleccionar lo que más te motiva en un trabajo: estabilidad, desarrollo, propósito, impacto, remuneración u otro factor.
Lo que elijas nos ayudará a ubicarte en una empresa donde encuentres no solo un cargo, sino un lugar en el que realmente te sientas inspirado y con ganas de dar lo mejor de ti.

                                        </p>
                                    </div>
                                </div>
                                
                                <div class="col-md-12">
                                    <p>Selecciona máximo 2 motivadores que sean más importantes para ti en tu vida laboral. Sé honesto: así lograremos un match real entre lo que buscas y lo que la empresa puede ofrecerte.</p>
                                </div>
                                <div class="col-md-12">
                                    {{ form.motivadores|as_crispy_field }}
                                </div> 
                            </div>
                        </div>
                        <button id="form_info_personal" type="submit" class="btn bg-primary bg-opacity-10 fw-medium text-primary py-2 px-4 w-100" form="form_info_personal">Guardar Cambios</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modales para visualizar archivos -->
<!-- Modal para imagen de perfil (nueva) -->
<div class="modal fade" id="modal_imagen_perfil" tabindex="-1" aria-labelledby="modal_imagen_perfil_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_imagen_perfil_label">Imagen de Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modal_img_imagen_perfil" src="" alt="Imagen de perfil" class="img-fluid" style="max-height: 70vh;">
            </div>
        </div>
    </div>
</div>

<!-- Modal para imagen de perfil (actual del servidor) -->
{% if candidato.imagen_perfil %}
<div class="modal fade" id="modal_imagen_perfil_current" tabindex="-1" aria-labelledby="modal_imagen_perfil_current_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_imagen_perfil_current_label">Imagen de Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img src="{{ candidato.imagen_perfil.url }}" alt="Imagen de perfil" class="img-fluid" style="max-height: 70vh;">
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Modal para hoja de vida (nueva) -->
<div class="modal fade" id="modal_hoja_de_vida" tabindex="-1" aria-labelledby="modal_hoja_de_vida_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_hoja_de_vida_label">Hoja de Vida</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal_body_hoja_de_vida">
                <iframe id="modal_iframe_hoja_de_vida" src="" style="width: 100%; height: 70vh; border: none; display: none;"></iframe>
            </div>
        </div>
    </div>
</div>

<!-- Modal para hoja de vida (actual del servidor) -->
{% if candidato.hoja_de_vida %}
<div class="modal fade" id="modal_hoja_de_vida_current" tabindex="-1" aria-labelledby="modal_hoja_de_vida_current_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_hoja_de_vida_current_label">Hoja de Vida</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% if candidato.hoja_de_vida.name|slice:"-4:" == ".pdf" %}
                    <iframe src="{{ candidato.hoja_de_vida.url }}" style="width: 100%; height: 70vh; border: none;"></iframe>
                {% else %}
                    <div class="alert alert-info">
                        <p>Para visualizar archivos Word, por favor descárgalo haciendo clic en el siguiente enlace:</p>
                        <a href="{{ candidato.hoja_de_vida.url }}" target="_blank" class="btn btn-primary">
                            <i class="ri-download-line me-1"></i> Descargar archivo
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Modal para video de perfil (nuevo) -->
<div class="modal fade" id="modal_video_perfil" tabindex="-1" aria-labelledby="modal_video_perfil_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_video_perfil_label">Video de Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <video id="modal_video_video_perfil" src="" controls class="w-100" style="max-height: 70vh;"></video>
            </div>
        </div>
    </div>
</div>

<!-- Modal para video de perfil (actual del servidor) -->
{% if candidato.video_perfil %}
<div class="modal fade" id="modal_video_perfil_current" tabindex="-1" aria-labelledby="modal_video_perfil_current_label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal_video_perfil_current_label">Video de Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <video src="{{ candidato.video_perfil.url }}" controls class="w-100" style="max-height: 70vh;"></video>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}


{% block js %} 
<script>
    initializeSelect2('#id_sexo');
    initializeSelect2('#id_ciudad_id_004');
    
    // Diccionario de descripciones de fit cultural desde el servidor
    var fitCulturalDescriptions = {{ fit_cultural_descriptions|safe }};
    
    // Inicializar tooltips para las descripciones de fit cultural
    function initializeFitCulturalTooltips() {
        // Buscar todos los inputs radio de fit cultural
        $('input[name^="grupo_fit_"]').each(function() {
            var $input = $(this);
            var value = $input.val();
            
            // Obtener la descripción del diccionario
            var descripcion = fitCulturalDescriptions[value];
            
            if (descripcion && descripcion.trim() !== '') {
                // Encontrar el label asociado
                var $label = $('label[for="' + $input.attr('id') + '"]');
                if ($label.length === 0) {
                    $label = $input.closest('.form-check').find('label');
                }
                
                if ($label.length > 0) {
                    // Destruir tooltip existente si hay uno
                    var existingTooltip = bootstrap.Tooltip.getInstance($label[0]);
                    if (existingTooltip) {
                        existingTooltip.dispose();
                    }
                    
                    // Agregar atributos de tooltip al label
                    $label.attr({
                        'data-bs-toggle': 'tooltip',
                        'data-bs-placement': 'top',
                        'data-bs-title': descripcion,
                        'data-bs-html': 'false'
                    });
                    
                    // Inicializar el tooltip de Bootstrap
                    try {
                        var tooltip = new bootstrap.Tooltip($label[0], {
                            placement: 'top',
                            html: false,
                            trigger: 'hover focus',
                            container: 'body'
                        });
                    } catch(e) {
                        console.error('Error inicializando tooltip:', e);
                    }
                }
            }
        });
    }
    
    
    // Event listeners para vista previa de archivos
    $(document).ready(function() {
        setTimeout(initializeFitCulturalTooltips, 300);
        
        // Función para marcar campos con errores en rojo y mostrar mensaje
        function markFieldAsError(fieldId, hasError, errorMessage) {
            var field = $('#' + fieldId);
            var fieldContainer = field.closest('.col-md-3, .col-md-4, .col-md-6, .col-md-12, .mb-3');
            
            // Buscar o crear el contenedor de mensaje de error
            var errorContainer = fieldContainer.find('.field-error-message');
            if (errorContainer.length === 0) {
                errorContainer = $('<div class="text-danger small field-error-message"></div>');
                fieldContainer.append(errorContainer);
            }
            
            if (hasError) {
                field.addClass('is-invalid');
                field.removeClass('is-valid');
                fieldContainer.addClass('has-error');
                if (errorMessage) {
                    errorContainer.html(errorMessage).show();
                }
            } else {
                field.removeClass('is-invalid');
                fieldContainer.removeClass('has-error');
                errorContainer.hide().html('');
            }
        }
        
        // Función para limpiar todos los errores visuales
        function clearAllErrors() {
            $('.is-invalid').removeClass('is-invalid');
            $('.has-error').removeClass('has-error');
            $('.field-error-message').hide().html('');
        }
        
        // Función para validar campos requeridos
        function validateRequiredFields() {
            clearAllErrors();
            var errors = [];
            var errorFields = [];
            
            // Campos requeridos según el formulario
            var requiredFields = {
                'id_email': 'Email',
                'id_primer_nombre': 'Primer Nombre',
                'id_primer_apellido': 'Primer Apellido',
                'id_numero_documento': 'Número de Documento',
                'id_ciudad_id_004': 'Ciudad',
                'id_sexo': 'Género',
                'id_fecha_nacimiento': 'Fecha de Nacimiento',
                'id_telefono': 'Teléfono',
                'id_direccion': 'Dirección'
            };
            
            // Validar cada campo requerido
            for (var fieldId in requiredFields) {
                var field = $('#' + fieldId);
                var fieldName = requiredFields[fieldId];
                var value = field.val();
                
                if (!value || (typeof value === 'string' && value.trim() === '')) {
                    errors.push(fieldName);
                    errorFields.push(fieldId);
                    markFieldAsError(fieldId, true, 'Este campo es obligatorio.');
                }
            }
            
            // Validar formato de email
            var emailField = $('#id_email');
            var emailValue = emailField.val();
            if (emailValue && emailValue.trim() !== '') {
                var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailValue)) {
                    if (errors.indexOf('Email') === -1) {
                        errors.push('Email');
                    }
                    markFieldAsError('id_email', true, 'Ingrese un email válido.');
                }
            }
            
            // Validar formato de teléfono (10 dígitos)
            var telefonoField = $('#id_telefono');
            var telefonoValue = telefonoField.val();
            if (telefonoValue && telefonoValue.trim() !== '') {
                var telefonoRegex = /^\d{10}$/;
                if (!telefonoRegex.test(telefonoValue)) {
                    if (errors.indexOf('Teléfono') === -1) {
                        errors.push('Teléfono');
                    }
                    markFieldAsError('id_telefono', true, 'El teléfono debe contener solo números y tener 10 dígitos.');
                }
            }
            
            // Validar formato de número de documento (solo números)
            var numeroDocField = $('#id_numero_documento');
            var numeroDocValue = numeroDocField.val();
            if (numeroDocValue && numeroDocValue.trim() !== '') {
                var numeroDocRegex = /^\d+$/;
                if (!numeroDocRegex.test(numeroDocValue)) {
                    if (errors.indexOf('Número de Documento') === -1) {
                        errors.push('Número de Documento');
                    }
                    markFieldAsError('id_numero_documento', true, 'El número de documento debe contener solo números.');
                }
            }
            
            return {
                hasErrors: errors.length > 0,
                errors: errors,
                errorFields: errorFields
            };
        }
        
        // Prevenir el scroll automático del navegador cuando hay errores de validación
        var form = document.getElementById('form_info_personal');
        if (form) {
            // Interceptar el submit para validar manualmente y prevenir el scroll automático
            form.addEventListener('submit', function(e) {
                // Guardar la posición actual del scroll
                var scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
                
                // Validar campos requeridos
                var validation = validateRequiredFields();
                
                if (validation.hasErrors) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Restaurar la posición del scroll inmediatamente
                    window.scrollTo(0, scrollPosition);
                    
                    // También prevenir cualquier scroll que pueda ocurrir después
                    setTimeout(function() {
                        window.scrollTo(0, scrollPosition);
                    }, 0);
                    setTimeout(function() {
                        window.scrollTo(0, scrollPosition);
                    }, 10);
                    setTimeout(function() {
                        window.scrollTo(0, scrollPosition);
                    }, 50);
                    
                    // Mostrar SweetAlert genérico (los mensajes específicos ya están debajo de cada campo)
                    Swal.fire({
                        title: 'Error en el formulario',
                        html: 'Por favor, revisa los campos marcados en rojo y corrige los errores antes de continuar.',
                        icon: 'error',
                        confirmButtonText: 'Entendido',
                        confirmButtonColor: '#B10022',
                        allowOutsideClick: false,
                        allowEscapeKey: true
                    });
                    
                    return false;
                }
            });
            
            // Limpiar errores visuales cuando el usuario empiece a escribir
            $('input, select, textarea').on('input change', function() {
                var fieldId = $(this).attr('id');
                if (fieldId) {
                    markFieldAsError(fieldId, false, '');
                }
            });
        }
        
        // Si hay errores en el formulario (del servidor), mostrar SweetAlert genérico y marcar campos
        {% if form.errors %}
            // Esperar a que el DOM esté completamente cargado antes de marcar campos
            setTimeout(function() {
                // Marcar campos con errores del servidor (los mensajes ya están en el template debajo de cada campo)
                {% for field, errors in form.errors.items %}
                    markFieldAsError('id_{{ field }}', true, ''); // El mensaje ya está en el template
                {% endfor %}
                
                // Mostrar SweetAlert genérico (los mensajes específicos ya están debajo de cada campo)
                Swal.fire({
                    title: 'Error en el formulario',
                    html: 'Por favor, revisa los campos marcados en rojo y corrige los errores antes de continuar.',
                    icon: 'error',
                    confirmButtonText: 'Entendido',
                    confirmButtonColor: '#B10022',
                    allowOutsideClick: false,
                    allowEscapeKey: true
                });
            }, 100);
        {% endif %}
    });
</script>  
{% endblock js %}