{% extends 'admin/layout/dashboard_base.html' %} 

{% load static %}
{% load crispy_forms_tags %}

{% block title %}
Wizard | Talent Tray
{% endblock %}

{% block styles %}
<style>
    /* Estilos para checkboxes en línea horizontal */
    .fit-cultural-checkboxes .form-check {
        display: inline-block !important;
        margin-right: 20px !important;
        margin-bottom: 10px !important;
        min-width: 180px !important;
    }

    .fit-cultural-checkboxes .form-check-input {
        margin-right: 8px !important;
    }

    .fit-cultural-checkboxes .form-check-label {
        display: inline !important;
        font-size: 14px !important;
        white-space: nowrap !important;
    }

    /* Responsive para pantallas pequeñas */
    @media (max-width: 768px) {
        .fit-cultural-checkboxes .form-check {
            min-width: 150px !important;
            margin-right: 15px !important;
        }
    }

    /* Estilos para motivadores también */
    .motivadores .form-check {
        display: inline-block !important;
        margin-right: 20px !important;
        margin-bottom: 10px !important;
        min-width: 180px !important;
    }
    
    /* Estilos para las secciones dinámicas - SOLO UNA VISIBLE A LA VEZ */
    .wizard-section {
        display: none !important;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out, visibility 0.4s ease-in-out;
        height: 0;
        overflow: hidden;
    }
    
    .wizard-section.active {
        display: block !important;
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
        height: auto;
        overflow: visible;
        animation: slideInUp 0.5s ease-out;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Forzar que solo una sección sea visible - regla adicional de seguridad */
    .wizard-section:not(.active) {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        overflow: hidden !important;
    }
    
    /* Efecto hover en los botones de navegación */
    .section-nav-btn {
        transition: all 0.3s ease;
    }
    
    .section-nav-btn:hover {
        background-color: rgba(177, 0, 34, 0.2) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* Indicador visual de sección activa */
    .wizard-section.active .card {
        border-color: #B10022 !important;
        box-shadow: 0 0 0 0.2rem rgba(177, 0, 34, 0.25) !important;
    }
    
    /* Smooth scroll */
    html {
        scroll-behavior: smooth;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-content-container overflow-hidden">
	<div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
		<h3 class="mb-0" style="color: #B10022;">WIZARD</h3>
		<nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
			<ol class="breadcrumb align-items-center mb-0 lh-1">
				<li class="breadcrumb-item">
					<a href="{% url 'accesses:inicio' %}" class="d-flex align-items-center text-decoration-none">
						<i class="ri-home-4-line fs-18 text-primary me-1"></i>
						<span class="text-secondary fw-medium hover" >Inicio</span>
					</a>
				</li>
				<li class="breadcrumb-item active" aria-current="page">
					<span class="fw-medium">Información Candidato</span>
				</li>
			</ol>
		</nav>
	</div>

	<!-- Panel de información -->
    {% include 'admin/candidate/candidate_user/layout/base_candidate_info_records.html' %}
    
    <div class="row">
		<div class="col-12 wizard-section active" id="section-info-personal">
            <div class="container-fluid mb-4">
                <div class="card bg-white border-1 border-primary border-opacity-25 rounded-3 mb-4 shadow-sm">
                    <div class="card-header bg-primary bg-opacity-10 align-middle border-0 text-center">
                        <p class="text-primary my-2 fs-4 fw-semibold d-inline-block">
                            <span class="material-symbols-outlined align-middle me-1" style="font-size: 25px;">person</span>
                            INFORMACIÓN BÁSICA
                        </p>
                    </div>
                    <div class="card-body">
                        <form method="post" id="form_info_personal" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="hidden" name="form_info_personal" value="1">
                            
                            <!-- Mostrar errores generales del formulario -->
                            {% if form_info_personal.non_field_errors %}
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    <strong>Error:</strong>
                                    <ul class="mb-0">
                                        {% for error in form_info_personal.non_field_errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endif %}
                            
                            <!-- DATOS PERSONALES -->
                            <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                                <div class="row">
                                    <div class="d-flex align-items-center my-4">
                                        <h6 class="mb-0 pe-3 text-primary fw-bold">DATOS PERSONALES</h6>
                                        <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.primer_nombre.label_tag }} 
                                        {{ form_info_personal.primer_nombre }}
                                        {% if form_info_personal.primer_nombre.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.primer_nombre.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.segundo_nombre.label_tag }} 
                                        {{ form_info_personal.segundo_nombre }}
                                        {% if form_info_personal.segundo_nombre.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.segundo_nombre.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.primer_apellido.label_tag }} 
                                        {{ form_info_personal.primer_apellido }}
                                        {% if form_info_personal.primer_apellido.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.primer_apellido.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.segundo_apellido.label_tag }} 
                                        {{ form_info_personal.segundo_apellido }}
                                        {% if form_info_personal.segundo_apellido.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.segundo_apellido.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.numero_documento.label_tag }} 
                                        {{ form_info_personal.numero_documento }}
                                        {% if form_info_personal.numero_documento.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.numero_documento.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.fecha_nacimiento.label_tag }} 
                                        {{ form_info_personal.fecha_nacimiento }}
                                        {% if form_info_personal.fecha_nacimiento.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.fecha_nacimiento.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.sexo.label_tag }} 
                                        {{ form_info_personal.sexo }}
                                        {% if form_info_personal.sexo.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.sexo.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        {{ form_info_personal.aspiracion_salarial.label_tag }} 
                                        {{ form_info_personal.aspiracion_salarial }}
                                        {% if form_info_personal.aspiracion_salarial.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.aspiracion_salarial.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- CONTACTO -->
                            <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                                <div class="row">
                                    <div class="d-flex align-items-center my-4">
                                        <h6 class="mb-0 pe-3 text-primary fw-bold">CONTACTO</h6>
                                        <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form_info_personal.email.label_tag }} 
                                        {{ form_info_personal.email }}
                                        {% if form_info_personal.email.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.email.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form_info_personal.telefono.label_tag }} 
                                        {{ form_info_personal.telefono }}
                                        {% if form_info_personal.telefono.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.telefono.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form_info_personal.ciudad_id_004.label_tag }} 
                                        {{ form_info_personal.ciudad_id_004 }}
                                        {% if form_info_personal.ciudad_id_004.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.ciudad_id_004.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form_info_personal.direccion.label_tag }} 
                                        {{ form_info_personal.direccion }}
                                        {% if form_info_personal.direccion.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.direccion.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- PERFIL -->
                            <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                                <div class="row">
                                    <div class="d-flex align-items-center my-4">
                                        <h6 class="mb-0 pe-3 text-primary fw-bold">PERFIL</h6>
                                        <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                                    </div>
                                    <div class="col-md-12 mb-3">
                                        {{ form_info_personal.perfil.label_tag }} 
                                        {{ form_info_personal.perfil }}
                                        {% if form_info_personal.perfil.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.perfil.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- DOCUMENTOS -->
                            <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                                <div class="row">
                                    <div class="d-flex align-items-center my-4">
                                        <h6 class="mb-0 pe-3 text-primary fw-bold">DOCUMENTOS</h6>
                                        <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        {{ form_info_personal.imagen_perfil.label_tag }} 
                                        {{ form_info_personal.imagen_perfil }}
                                        {% if form_info_personal.imagen_perfil.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.imagen_perfil.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        {% if candidate.imagen_perfil %}
                                            <div class="mt-2">
                                                <span class="text-secondary small">Archivo actual: <span class="filename-display">{{ candidate.imagen_perfil.name }}</span></span>
                                                {% if candidate.imagen_perfil.url %}
                                                    <div class="mt-2">
                                                        <img src="{{ candidate.imagen_perfil.url }}" alt="Imagen de perfil" style="max-width: 150px; max-height: 150px; border-radius: 8px;">
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        {{ form_info_personal.hoja_de_vida.label_tag }} 
                                        {{ form_info_personal.hoja_de_vida }}
                                        {% if form_info_personal.hoja_de_vida.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.hoja_de_vida.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        {% if candidate.hoja_de_vida %}
                                            <div class="mt-2">
                                                <span class="text-secondary small">Archivo actual: <span class="filename-display">{{ candidate.hoja_de_vida.name }}</span></span>
                                                {% if candidate.hoja_de_vida.url %}
                                                    <div class="mt-2">
                                                        <a href="{{ candidate.hoja_de_vida.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                            <i class="ri-file-pdf-line me-1"></i>Ver PDF
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        {{ form_info_personal.video_perfil.label_tag }} 
                                        {{ form_info_personal.video_perfil }}
                                        {% if form_info_personal.video_perfil.help_text %}
                                            <small class="form-text text-muted">{{ form_info_personal.video_perfil.help_text }}</small>
                                        {% endif %}
                                        {% if form_info_personal.video_perfil.errors %}
                                            <div class="text-danger small mt-1">
                                                {% for error in form_info_personal.video_perfil.errors %}
                                                    <div><i class="ri-error-warning-line me-1"></i>{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        {% if candidate.video_perfil %}
                                            <div class="mt-2">
                                                <span class="text-secondary small">Video actual: <span class="filename-display">{{ candidate.video_perfil.name }}</span></span>
                                                {% if candidate.video_perfil.url %}
                                                    <div class="mt-2">
                                                        <video width="100%" controls style="max-width: 300px;">
                                                            <source src="{{ candidate.video_perfil.url }}" type="video/mp4">
                                                            Tu navegador no soporta el elemento de video.
                                                        </video>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- FIT CULTURAL -->
                            <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                                <div class="d-flex align-items-center my-4">
                                    <h6 class="mb-0 pe-3 text-primary fw-bold">FIT CULTURAL</h6>
                                    <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="alert alert-info" role="alert">
                                            <h4 class="alert-heading">
                                                <span class="material-symbols-outlined text-info me-2">psychology</span>
                                                Selecciona tus habilidades blandas
                                            </h4>
                                            <p>
                                                En esta sección podrás elegir el entorno y estilo de cultura donde te sientes más cómodo y das lo mejor de ti: cómo prefieres trabajar, el liderazgo que más te impulsa, tu ritmo ideal, la forma en que te comunicas y cómo tomas decisiones.
                                                Lo que selecciones nos permitirá ubicarte en una empresa donde no solo encajes por tu experiencia técnica, sino donde realmente puedas fluir, aportar valor y crecer.
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-12">
                                        <p>Selecciona una opción por cada categoría (Estilo de trabajo, Liderazgo, Ritmo, Comunicación y Decisiones). Marca lo que más se ajusta a tu realidad: así lograremos un match auténtico entre tu estilo y la cultura de la empresa.</p>
                                    </div>
                                    <hr class="my-4">
                                    <div class="col-md-4">
                                        {{ form_info_personal.grupo_fit_1|as_crispy_field }}
                                    </div> 
                                    <div class="col-md-4">
                                        {{ form_info_personal.grupo_fit_2|as_crispy_field }}
                                    </div> 
                                    <div class="col-md-4">
                                        {{ form_info_personal.grupo_fit_3|as_crispy_field }}
                                    </div> 
                                    <div class="col-md-4">
                                        {{ form_info_personal.grupo_fit_4|as_crispy_field }}
                                    </div> 
                                    <div class="col-md-4">
                                        {{ form_info_personal.grupo_fit_5|as_crispy_field }}
                                    </div> 
                                </div>
                            </div>
                            
                            <!-- MOTIVADORES -->
                            <div class="mb-4 p-3 border rounded bg-primary bg-opacity-10">
                                <div class="d-flex align-items-center my-4">
                                    <h6 class="mb-0 pe-3 text-primary fw-bold">MOTIVADORES</h6>
                                    <hr class="flex-grow-1 m-0 border-top border-1 border-secondary opacity-20">
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="alert alert-info" role="alert">
                                            <h4 class="alert-heading">
                                                <span class="material-symbols-outlined text-info me-2">emoji_objects</span>
                                                Selecciona tus motivadores
                                            </h4>
                                            <p>
                                                En esta sección podrás seleccionar lo que más te motiva en un trabajo: estabilidad, desarrollo, propósito, impacto, remuneración u otro factor.
                                                Lo que elijas nos ayudará a ubicarte en una empresa donde encuentres no solo un cargo, sino un lugar en el que realmente te sientas inspirado y con ganas de dar lo mejor de ti.
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-12">
                                        <p>Selecciona máximo 2 motivadores que sean más importantes para ti en tu vida laboral. Sé honesto: así lograremos un match real entre lo que buscas y lo que la empresa puede ofrecerte.</p>
                                    </div>
                                    <div class="col-md-12">
                                        {{ form_info_personal.motivadores|as_crispy_field }}
                                    </div> 
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn bg-primary bg-opacity-10 fw-medium text-primary py-2 px-4 w-100">
                                    Guardar Información Básica
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 wizard-section" id="section-info-academica">
            <div class="container-fluid mb-4">
                <div class="card bg-white border-1 border-primary border-opacity-25 rounded-3 mb-4 shadow-sm">
                    <div class="card-header bg-primary bg-opacity-10 align-middle border-0 text-center">
                        <p class="text-primary my-2 fs-4 fw-semibold d-inline-block">
                            <span class="material-symbols-outlined align-middle me-1" style="font-size: 25px;">school</span>
                            INFORMACIÓN ACADÉMICA
                        </p>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h5 class="mb-3">Listado de Estudios</h5>
                            {% if studies %}
                            <div class="table-responsive">
                                <table class="table align-middle text-center">
                                    <thead>
                                        <tr>
                                            <th scope="col">INSTITUCIÓN</th>
                                            <th scope="col">FECHA INICIAL</th>
                                            <th scope="col">FECHA FINAL</th>
                                            <th scope="col">TÍTULO</th>
                                            <th scope="col">TIPO DE ESTUDIO</th>
                                            <th scope="col">ACCIONES</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for study in studies %}
                                        <tr>
                                            <td>{{ study.institucion }}</td>
                                            <td>{{ study.fecha_inicial|date:"Y-m-d" }}</td>
                                            <td>{% if study.fecha_final %}{{ study.fecha_final|date:"Y-m-d" }}{% else %}--{% endif %}</td>
                                            <td>{% if study.titulo %}{{ study.titulo }}{% else %}--{% endif %}</td>
                                            <td>{{ study.mostrar_tipo_estudio }}</td>
                                            <td>
                                                <a href="{% url 'candidatos:candidato_info_academica_editar' study.id %}" class="btn bg-danger bg-opacity-10 fw-medium text-danger py-2 px-3">
                                                    <i class="material-symbols-outlined fs-16 text-danger">edit</i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <p class="text-muted">No hay estudios registrados.</p>
                            {% endif %}
                        </div>
                        <hr>
                        <h5 class="mb-3">Agregar Nuevo Estudio</h5>
                        <form method="post" id="form_info_academica" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="hidden" name="form_info_academica" value="1">
                            {% crispy form_info_academica %}
                            <button type="submit" class="btn bg-primary bg-opacity-10 fw-medium text-primary py-2 px-4 w-100 mt-3">Guardar Estudio</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 wizard-section" id="section-info-laboral">
            <div class="container-fluid mb-4">
                <div class="card bg-white border-1 border-primary border-opacity-25 rounded-3 mb-4 shadow-sm">
                    <div class="card-header bg-primary bg-opacity-10 align-middle border-0 text-center">
                        <p class="text-primary my-2 fs-4 fw-semibold d-inline-block">
                            <span class="material-symbols-outlined align-middle me-1" style="font-size: 25px;">work</span>
                            INFORMACIÓN LABORAL
                        </p>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h5 class="mb-3">Listado de Experiencias Laborales</h5>
                            {% if jobs %}
                            <div class="table-responsive">
                                <table class="table align-middle text-center">
                                    <thead>
                                        <tr>
                                            <th scope="col">ENTIDAD</th>
                                            <th scope="col">SECTOR</th>
                                            <th scope="col">CARGO</th>
                                            <th scope="col">ACTIVO</th>
                                            <th scope="col">FECHA INICIAL</th>
                                            <th scope="col">FECHA FINAL</th>
                                            <th scope="col">ACCIONES</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for job in jobs %}
                                        <tr>
                                            <td>{{ job.entidad }}</td>
                                            <td>{{ job.sector }}</td>
                                            <td>{{ job.cargo }}</td>
                                            <td>{% if job.activo %}Sí{% else %}No{% endif %}</td>
                                            <td>{{ job.fecha_inicial|date:"Y-m-d" }}</td>
                                            <td>{% if job.fecha_final %}{{ job.fecha_final|date:"Y-m-d" }}{% else %}--{% endif %}</td>
                                            <td>
                                                <a href="{% url 'candidatos:candidato_info_laboral_editar' job.id %}" class="btn bg-danger bg-opacity-10 fw-medium text-danger py-2 px-3">
                                                    <i class="material-symbols-outlined fs-16 text-danger">edit</i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <p class="text-muted">No hay experiencias laborales registradas.</p>
                            {% endif %}
                        </div>
                        <hr>
                        <h5 class="mb-3">Agregar Nueva Experiencia Laboral</h5>
                        <form method="post" id="form_info_laboral">
                            {% csrf_token %}
                            <input type="hidden" name="form_info_laboral" value="1">
                            {% crispy form_info_laboral %}
                            <button type="submit" class="btn bg-primary bg-opacity-10 fw-medium text-primary py-2 px-4 w-100 mt-3">Guardar Experiencia</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-12 wizard-section" id="section-info-habilidades">
            <div class="container-fluid mb-4">
                <div class="card bg-white border-1 border-primary border-opacity-25 rounded-3 mb-4 shadow-sm">
                    <div class="card-header bg-primary bg-opacity-10 align-middle border-0 text-center">
                        <p class="text-primary my-2 fs-4 fw-semibold d-inline-block">
                            <span class="material-symbols-outlined align-middle me-1" style="font-size: 25px;">psychology</span>
                            INFORMACIÓN HABILIDADES
                        </p>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h5 class="mb-3">Habilidades Actuales</h5>
                            {% if skills %}
                            <div class="row">
                                {% for skill in skills %}
                                <div class="col-md-3 mb-2">
                                    <span class="badge bg-primary bg-opacity-10 text-primary p-2">{{ skill.skill_id_104.nombre }}</span>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <p class="text-muted">No hay habilidades registradas.</p>
                            {% endif %}
                        </div>
                        <hr>
                        <h5 class="mb-3">Seleccionar Habilidades</h5>
                        <form method="post" id="form_info_habilidades" enctype="multipart/form-data">
                            {% csrf_token %}
                            <input type="hidden" name="form_info_habilidades" value="1">
                            {% crispy form_info_habilidades %}
                            <button type="submit" class="btn bg-primary bg-opacity-10 fw-medium text-primary py-2 px-4 w-100 mt-3">Guardar Habilidades</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 wizard-section" id="section-info-redes">
            <div class="container-fluid mb-4">
                <div class="card bg-white border-1 border-primary border-opacity-25 rounded-3 mb-4 shadow-sm">
                    <div class="card-header bg-primary bg-opacity-10 align-middle border-0 text-center">
                        <p class="text-primary my-2 fs-4 fw-semibold d-inline-block">
                            <span class="material-symbols-outlined align-middle me-1" style="font-size: 25px;">share</span>
                            INFORMACIÓN REDES SOCIALES
                        </p>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h5 class="mb-3">Redes Sociales Actuales</h5>
                            {% if socialNetwork %}
                            <div class="table-responsive">
                                <table class="table align-middle text-center">
                                    <thead>
                                        <tr>
                                            <th scope="col">RED SOCIAL</th>
                                            <th scope="col">URL</th>
                                            <th scope="col">ACCIONES</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for red in socialNetwork %}
                                        <tr>
                                            <td>{{ red.red_social_id_105.nombre }}</td>
                                            <td><a href="{{ red.url }}" target="_blank">{{ red.url }}</a></td>
                                            <td>
                                                <a href="{% url 'candidatos:candidato_info_redes_editar' red.id %}" class="btn bg-danger bg-opacity-10 fw-medium text-danger py-2 px-3">
                                                    <i class="material-symbols-outlined fs-16 text-danger">edit</i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <p class="text-muted">No hay redes sociales registradas.</p>
                            {% endif %}
                        </div>
                        <hr>
                        <h5 class="mb-3">Agregar Nueva Red Social</h5>
                        <form method="post" id="form_info_redes">
                            {% csrf_token %}
                            <input type="hidden" name="form_info_redes" value="1">
                            {% crispy form_info_redes %}
                            <button type="submit" class="btn bg-primary bg-opacity-10 fw-medium text-primary py-2 px-4 w-100 mt-3">Guardar Red Social</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %} 
<script>
	// Navegación dinámica entre secciones
	$(document).ready(function() {
		// Función para cambiar de sección - GARANTIZA SOLO UNA VISIBLE
		function showSection(sectionId) {
			// Obtener la sección objetivo
			var $targetSection = $('#' + sectionId);
			
			// Si la sección ya está activa, no hacer nada
			if ($targetSection.hasClass('active')) {
				return;
			}
			
			// FORZAR: Remover la clase active de TODAS las secciones primero
			$('.wizard-section').removeClass('active');
			
			// Asegurar que todas estén ocultas
			$('.wizard-section').css({
				'display': 'none',
				'visibility': 'hidden',
				'height': '0',
				'overflow': 'hidden'
			});
			
			// Esperar un momento para que se complete la ocultación
			setTimeout(function() {
				// Mostrar SOLO la sección objetivo
				$targetSection.addClass('active');
				$targetSection.css({
					'display': 'block',
					'visibility': 'visible',
					'height': 'auto',
					'overflow': 'visible'
				});
				
				// Disparar evento personalizado
				$(document).trigger('sectionChanged', [sectionId]);
				
				// Scroll suave hacia la sección
				setTimeout(function() {
					if ($targetSection.length && $targetSection.offset()) {
						$('html, body').animate({
							scrollTop: $targetSection.offset().top - 100
						}, 600);
					}
				}, 100);
			}, 150);
		}
		
		// Manejar clics en los botones de navegación
		$('.section-nav-btn').on('click', function(e) {
			e.preventDefault();
			var sectionId = $(this).data('section');
			if (sectionId) {
				showSection(sectionId);
			}
		});
		
		// FORZAR: Asegurar que SOLO la sección de información básica esté activa inicialmente
		// Remover active de todas las secciones
		$('.wizard-section').removeClass('active');
		$('.wizard-section').css({
			'display': 'none',
			'visibility': 'hidden',
			'height': '0',
			'overflow': 'hidden'
		});
		
		// Verificar si hay errores en el formulario de información básica
		var hasErrors = $('#section-info-personal').find('.text-danger, .alert-danger').length > 0;
		
		// Activar SOLO la sección de información básica (o la que tenga errores)
		var $infoPersonal = $('#section-info-personal');
		if (hasErrors || $infoPersonal.find('form').length > 0) {
			$infoPersonal.addClass('active');
			$infoPersonal.css({
				'display': 'block',
				'visibility': 'visible',
				'height': 'auto',
				'overflow': 'visible'
			});
			
			// Si hay errores, hacer scroll hacia ellos
			if (hasErrors) {
				setTimeout(function() {
					$('html, body').animate({
						scrollTop: $infoPersonal.offset().top - 100
					}, 600);
				}, 300);
			}
		} else {
			// Si no hay errores, activar información básica por defecto
			$infoPersonal.addClass('active');
			$infoPersonal.css({
				'display': 'block',
				'visibility': 'visible',
				'height': 'auto',
				'overflow': 'visible'
			});
		}
		
		// Verificar si hay un parámetro en la URL para mostrar una sección específica
		var urlParams = new URLSearchParams(window.location.search);
		var sectionParam = urlParams.get('section');
		if (sectionParam) {
			showSection('section-info-' + sectionParam);
		}
		
		// Inicializar Select2 para los campos de selección
		function initializeSelect2ForSection(sectionId) {
			var section = $('#' + sectionId);
			
			// Función auxiliar para inicializar Select2 solo si no está ya inicializado
			function initSelect2IfNeeded(selector) {
				var $element = section.find(selector);
				if ($element.length && !$element.hasClass('select2-hidden-accessible')) {
					try {
						initializeSelect2(selector);
					} catch(e) {
						console.log('Error inicializando Select2 para ' + selector + ':', e);
					}
				}
			}
			
			// Información básica
			initSelect2IfNeeded('#id_sexo');
			initSelect2IfNeeded('#id_ciudad_id_004');
			
			// Información académica
			initSelect2IfNeeded('#id_tipo_estudio');
			initSelect2IfNeeded('#id_profesion_estudio');
			// Nota: ciudad_id_004 puede estar en múltiples secciones, se maneja por ID único
			
			// Información laboral
			initSelect2IfNeeded('#id_motivo_salida');
			initSelect2IfNeeded('#id_modalidad_trabajo');
			
			// Redes sociales
			initSelect2IfNeeded('#id_red_social_id_105');
		}
		
		// Inicializar Select2 cuando se muestra una sección
		$('.wizard-section').on('transitionend', function() {
			if ($(this).hasClass('active')) {
				setTimeout(function() {
					initializeSelect2ForSection($(this).attr('id'));
				}.bind(this), 100);
			}
		});
		
		// Inicializar Select2 para la sección activa al cargar
		setTimeout(function() {
			$('.wizard-section.active').each(function() {
				initializeSelect2ForSection($(this).attr('id'));
			});
		}, 300);
		
		// Toggle campos de graduado en formulario académico
		function toggleGraduationFields() {
			if ($('#id_grado_en').is(':checked')) {
				$('.campo-graduado').show();
			} else {
				$('.campo-graduado').hide();
			}
		}
		
		if ($('#id_grado_en').length) {
			toggleGraduationFields();
			$('#id_grado_en').change(toggleGraduationFields);
		}
		
		// Toggle campos de activo en formulario laboral
		function toggleActiveFields() {
			if ($('#id_activo').is(':checked')) {
				$('.campo-activo').hide();
			} else {
				$('.campo-activo').show();
			}
		}
		
		if ($('#id_activo').length) {
			toggleActiveFields();
			$('#id_activo').change(toggleActiveFields);
		}
		
		// Observador para inicializar Select2 cuando una sección se vuelve visible
		var observer = new MutationObserver(function(mutations) {
			mutations.forEach(function(mutation) {
				if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
					var target = $(mutation.target);
					if (target.hasClass('active') && !target.data('select2-initialized')) {
						setTimeout(function() {
							initializeSelect2ForSection(target.attr('id'));
							target.data('select2-initialized', true);
						}, 400);
					}
				}
			});
		});
		
		// Observar cambios en las secciones
		$('.wizard-section').each(function() {
			observer.observe(this, { attributes: true, attributeFilter: ['class'] });
		});
		
		// También inicializar Select2 cuando se cambia de sección manualmente
		$(document).on('sectionChanged', function(e, sectionId) {
			setTimeout(function() {
				initializeSelect2ForSection(sectionId);
			}, 400);
		});
		
		// Mantener archivos seleccionados después de errores de validación
		// Guardar referencias de archivos en localStorage cuando se seleccionan
		$('#id_imagen_perfil, #id_hoja_de_vida, #id_video_perfil').on('change', function() {
			var input = this;
			var fieldName = $(input).attr('id');
			
			if (input.files && input.files[0]) {
				var file = input.files[0];
				var reader = new FileReader();
				
				reader.onload = function(e) {
					// Guardar información del archivo en sessionStorage
					var fileData = {
						name: file.name,
						size: file.size,
						type: file.type,
						lastModified: file.lastModified
					};
					sessionStorage.setItem('file_' + fieldName, JSON.stringify(fileData));
				};
				
				// Leer como data URL para imágenes, o solo guardar metadata para otros
				if (file.type.startsWith('image/')) {
					reader.readAsDataURL(file);
				} else {
					reader.readAsArrayBuffer(file);
				}
			}
		});
		
		// Mostrar indicador visual cuando hay archivos guardados
		function checkSavedFiles() {
			['id_imagen_perfil', 'id_hoja_de_vida', 'id_video_perfil'].forEach(function(fieldId) {
				var savedFile = sessionStorage.getItem('file_' + fieldId);
				if (savedFile) {
					try {
						var fileData = JSON.parse(savedFile);
						var $input = $('#' + fieldId);
						var $label = $input.closest('.col-md-4, .col-md-3').find('label');
						
						// Agregar indicador visual
						if ($label.find('.file-saved-indicator').length === 0) {
							$label.append('<span class="file-saved-indicator text-success ms-2"><i class="ri-checkbox-circle-line"></i> Archivo seleccionado</span>');
						}
					} catch(e) {
						console.error('Error parsing saved file data:', e);
					}
				}
			});
		}
		
		// Verificar archivos guardados al cargar
		setTimeout(checkSavedFiles, 500);
		
		// Función para extraer solo el nombre del archivo sin la ruta
		function extractFilename(fullPath) {
			if (!fullPath) return '';
			// Manejar tanto barras normales como invertidas (Windows/Linux)
			// También manejar rutas que empiecen con "candidate/" o similares
			fullPath = fullPath.replace(/^.*[\/\\]/, ''); // Eliminar todo hasta la última barra
			return fullPath;
		}
		
		// Función para procesar todos los nombres de archivo
		function processFilenames() {
			$('.filename-display').each(function() {
				var $this = $(this);
				var fullPath = $this.text().trim();
				if (fullPath) {
					var filename = extractFilename(fullPath);
					if (filename && filename !== fullPath && filename.length > 0) {
						$this.text(filename);
					}
				}
			});
		}
		
		// Aplicar inmediatamente cuando el DOM esté listo
		processFilenames();
		
		// Aplicar después de un pequeño delay para asegurar que el contenido esté renderizado
		setTimeout(processFilenames, 100);
		setTimeout(processFilenames, 500);
		setTimeout(processFilenames, 1000);
		
		// También aplicar cuando se muestre la sección de información personal
		$(document).on('sectionChanged', function(e, sectionId) {
			if (sectionId === 'section-info-personal') {
				setTimeout(processFilenames, 100);
				setTimeout(processFilenames, 300);
			}
		});
		
		// Aplicar después de que se cargue completamente la página
		$(window).on('load', function() {
			setTimeout(processFilenames, 200);
			setTimeout(processFilenames, 500);
		});
		
		// Observar cambios en el DOM para procesar nuevos elementos
		var observer = new MutationObserver(function(mutations) {
			mutations.forEach(function(mutation) {
				if (mutation.addedNodes.length) {
					setTimeout(processFilenames, 100);
				}
			});
		});
		
		// Observar cambios en el body
		if (document.body) {
			observer.observe(document.body, {
				childList: true,
				subtree: true
			});
		}
		
		// El formulario ahora debería funcionar correctamente
		// El botón está dentro del formulario y se enviará normalmente
	});
</script>  
{% endblock js %}
